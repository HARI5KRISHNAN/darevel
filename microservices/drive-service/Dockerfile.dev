# Development Dockerfile - Uses mvn spring-boot:run for hot reload
FROM maven:3.9-eclipse-temurin-21

WORKDIR /app

# Copy parent POM
COPY pom.xml ../

# Copy all module POMs
COPY api-gateway/pom.xml ../api-gateway/
COPY user-service/pom.xml ../user-service/
COPY drive-service/pom.xml ../drive-service/
COPY mail-service/pom.xml ../mail-service/
COPY chat-service/pom.xml ../chat-service/
COPY notify-service/pom.xml ../notify-service/
COPY excel-service/pom.xml ../excel-service/
COPY slides-service/pom.xml ../slides-service/
COPY common/pom.xml ../common/

# Copy common module source (required dependency)
COPY common/src ../common/src

# Copy drive-service source
COPY drive-service/src ../drive-service/src

# Download dependencies
RUN mvn dependency:go-offline -pl drive-service -am

# Expose port
EXPOSE 8083

# Working directory for the specific service
WORKDIR /app/drive-service

# Run using Spring Boot Maven plugin with dev profile
CMD ["mvn", "spring-boot:run", "-Dspring-boot.run.jvmArguments=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"]
