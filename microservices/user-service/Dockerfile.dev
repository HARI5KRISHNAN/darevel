# Development Dockerfile - Uses mvn spring-boot:run for hot reload
FROM maven:3.9-eclipse-temurin-21

WORKDIR /app

# Copy parent POM
COPY pom.xml ../

# Copy all module POMs (Maven needs to see all modules referenced in parent POM)
COPY api-gateway/pom.xml ../api-gateway/
COPY user-service/pom.xml ../user-service/
COPY drive-service/pom.xml ../drive-service/
COPY mail-service/pom.xml ../mail-service/
COPY chat-service/pom.xml ../chat-service/
COPY notify-service/pom.xml ../notify-service/
COPY excel-service/pom.xml ../excel-service/
COPY slides-service/pom.xml ../slides-service/
COPY common/pom.xml ../common/

# Copy common module source (required dependency)
COPY common/src ../common/src

# Copy user-service source
COPY user-service/src ../user-service/src

# Download dependencies (this layer will be cached unless POMs change)
RUN mvn dependency:go-offline -pl user-service -am

# Expose port
EXPOSE 8082

# Working directory for the specific service
WORKDIR /app/user-service

# Run using Spring Boot Maven plugin with dev profile
CMD ["mvn", "spring-boot:run", "-Dspring-boot.run.jvmArguments=-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005"]
